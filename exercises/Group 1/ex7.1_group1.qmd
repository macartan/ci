---
title: "Group 1 - Week 4"
subtitle: "7 Experimental Design"
date: "1 Feburary, 2024"
author: Ziyu, Nora, Elias, Felix, Anton 

format: revealjs
editor: visual
---

```{r packages, echo=FALSE}
# packages
pacman::p_load(tidyverse,
               rstan,
               DeclareDesign,
               dagitty,
               CausalQueries,
               ri2,
               knitr,
               kableExtra)
```

# Randomization

100 students sign up to take part in an experiment. You want to measure the effect of immigration on social trust. Half your subjects are men and half are women and you believe gender is very predictive of social trust.

Your experiment involves varying whether a "native" or an "immigrant" facilitator instructs players in how to play a trust game. You have five native and five immigrant facilitators and you want them each to conduct one session with 10 subjects.

### Scenario 1

You are free to assign both subjects and facilitators to sessions. Propose an appropriate randomization strategy. Is it blocked? Clustered? Both?

#### Answer

Randomization strategy:

Yes we block for gender since gender is very predictive of social trust. In addition we cluster at the session level, since the trainers vary by group.

```{r}
set.seed(123) #set seed for reproducibility
n <- 100 #number of Students
g <- sample(c("male", "female"), n, replace = TRUE, prob = c(0.5, 0.5)) #gender
f <- sample(c("native", "immigrant"), 10, replace = TRUE, prob = c(0.5, 0.5)) # facilitators

M1 <- 
  declare_model(N=n,
                G=g,
                F=rbinom(10, 1, prob = c(0.5, 0.5)),
                potential_outcomes(Y ~ 0.2 * G + F)) +
  declare_assignment(G=block_ra(blocks = G, block_prob = c(0.5, 0.5))) + #using 'gender' as block
 declare_measurement(Y = reveal_outcomes(Y ~ F)) +
  declare_estimator(Y ~ treated*female|facilitator, 
                    .method = lm_lin,
                    label = "Lin",
                    cluster = ~ paste(f), 
  )
```

### Scenario 2

Say now that subjects have already signed up for sessions. You can only assign facilitators to sessions, but you have access to the subject lists before you do so. Describe your optimal randomization strategy. Is it blocked? Clustered? Both?

### Answer

We can no longer block for gender since the groups are already created. We still cluster by facilitator.

Look at what happens with the varying ICC.

### Declare Design

```{r}
f <- 10 ##Facilitators
f_per_f <- 5 ##female per facilitator
m_per_f <- 5 ##male per facilitator
g_vector<- rep(c("male","female"), each = n/2) ##generate a vector indicating the gender of each student
shuffled_g_vector <- sample(g_vector) ##shuffled the gender to randomize the assignment to facilitators
assign_students <- function(g, n_per_f){
  grouped_
}

```

### 
