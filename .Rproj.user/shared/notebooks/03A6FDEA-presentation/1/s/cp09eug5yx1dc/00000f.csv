"0","#| eval: !expr params$run"
"0",""
"0","# plot twoway country level BLUPs"
"0",""
"0","df_all <- lapply(c(""normal"", ""libind""),"
"0","       function(z){"
"0","         "
"0","         if(z==""normal""){"
"0","           "
"0","           ranefs <- df_mod1_ranefs"
"0","           fixefs <- df_mod1_fixefs"
"0","           "
"0","         } else {"
"0","           "
"0","           ranefs <- df_mod_libind_ranefs"
"0","           fixefs <- df_mod_libind_fixefs"
"0","         }"
"0","         "
"0","         fixefs <- fixefs %>% "
"0","           select(term, fixef = estimate, std.dev, model)"
"0","         "
"0","         ranefs <- ranefs %>% "
"0","           select(country, term, ranef = estimate, model) %>% "
"0","           left_join(fixefs) %>% "
"0","           filter(!grepl(""_"", term))"
"0","         "
"0","         ranefs <- ranefs %>% "
"0","           mutate(estimate = ranef + fixef,"
"0","                  term = factor(term, levels = c(dimensions$var_label,"
"0","                                                 ""simple liberalism index"","
"0","                                                 ""induced liberalism index""))) %>% "
"0","           select(country, term, estimate, model) %>% "
"0","           left_join(region_df)"
"0","         "
"0","         left_df <- "
"0","           ranefs %>% "
"0","           filter(term!=""income"") %>% "
"0","           rename(xlab = term, y = estimate)"
"0","         "
"0","         right_df <- "
"0","           ranefs %>% "
"0","           filter(term==""income"") %>% "
"0","           rename(ylab = term, x = estimate)"
"0","         "
"0","         ranefs <- "
"0","           left_df %>% "
"0","           left_join(right_df) %>% "
"0","           mutate(type = z)"
"0","         "
"0","         return(ranefs)"
"0","         "
"0","       }) %>% "
"0","  bind_rows()"
"2","Joining with `by = join_by(term, model)`"
"2","Joining with `by = join_by(country)`"
"2","Joining with `by = join_by(country, model, code)`"
"2","Joining with `by = join_by(term, model)`"
"2","Joining with `by = join_by(country)`"
"2","Joining with `by = join_by(country, model, code)`"
"0","# plot"
"0",""
"0","line_df <- "
"0","  data.frame(x = seq(0, 0.5, length.out = 100)) %>% "
"0","  mutate(y = x, negy = -y)"
"0",""
"0","p_twoway_inc <- ggplot() +"
"0","  geom_point(aes(x, y), col = ""#98b6e4"", "
"0","             data = df_all, size = 2) +"
"0","  geom_text(aes(x, y, label = code), color = ""black"", nudge_y = 0.3, size = 2, "
"0","            data = df_all) + "
"0","  geom_line(aes(x, y), col = ""red"", linetype = ""dashed"", data = line_df) +"
"0","  geom_line(aes(x, negy), col = ""red"", linetype = ""dashed"", data = line_df) +"
"0","  facet_manual(~xlab, scales = ""fixed"","
"0","               design = matrix(1:8, 4, 2, byrow = TRUE),"
"0","               labeller = labeller(xlab = label_wrap_gen(width = 18), "
"0","                                   ylab = label_wrap_gen(width = 18)),"
"0","               strip.position = ""top"") +"
"0","  theme_bw() +"
"0","  geom_vline(xintercept = 0, size = 0.4, col = ""black"", linetype = ""dashed"") +"
"0","  geom_hline(yintercept = 0, size = 0.4, col = ""black"", linetype = ""dashed"") +"
"0","  scale_y_continuous(trans = scales::pseudo_log_trans(sigma = 0.01),"
"0","                     breaks = c(-0.8, -0.4, -0.2, -0.1, -0.05, -0.025, 0, 0.025, 0.05, 0.1, 0.2, 0.4, 0.8)) +"
"0","  scale_x_continuous(limits = c(0, 0.45)) +"
"0","  ggtitle(""Plot of all two way combinations for income"") +"
"0","  ylab(""Liberal attribute"") +"
"0","  xlab(paste0(""income\n\nCountries\n\n"","
"0","       paste0(region_df %>% "
"0","                  mutate(legend = paste(code, ""="", country)) %>%"
"0","                  .$legend %>%"
"0","                  paste(collapse = "", "")) %>% "
"0","           str_wrap(130))) + # in elsevier format have to change \n linebreak to <br>"
"0","  ylab(""Liberal attribute"") +"
"0","  theme(axis.title.x = ggtext::element_markdown(),"
"0","        legend.position = ""bottom"")"
"0",""
"0","p_twoway_inc %>% "
"0","  write_rds(""saved/p_twoway_inc.rds"")"
"0",""
