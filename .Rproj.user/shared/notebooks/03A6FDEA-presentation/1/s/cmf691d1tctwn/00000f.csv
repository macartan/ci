"0","#| eval: !expr params$run"
"0",""
"0","df_cor <- df_mod1_ranefs %>% "
"0","  mutate(term = str_replace_all(term, setNames(dimensions$var_name, dimensions$var_label))) %>%"
"0","  filter(!grepl(""_"", term)) %>% "
"0","  pivot_wider(id_cols = ""country"","
"0","              names_from = ""term"","
"0","              values_from = ""estimate"") %>% "
"0","  select(-country)"
"0",""
"0","cb_alpha <- df_cor %>%"
"0","  alpha(check.keys = TRUE)"
"2","Number of categories should be increased  in order to count frequencies. 
"
"2","Warning: Some items were negatively correlated with the first principal component and were automatically reversed.
 This is indicated by a negative sign for the variable name."
"0","cb_alpha %>% "
"0","  write_rds(""saved/cb_alpha.rds"")"
"0",""
"0","cormat <- cor(df_cor)"
"0",""
"0","upper_tri <- cor_test(df_cor %>% select(-X7)) %>% "
"0","  filter(var1!=var2) %>% "
"0","  mutate(across(c(var1, var2), "
"0","                function(x) str_remove(x, ""X"") %>% as.numeric)) %>% "
"0","  filter(var1<var2) %>% "
"0","  mutate(across(c(var1, var2), function(x) paste0(""X"", x))) %>% "
"0","  mutate(stars = ifelse(p<.05, ""*"", """"),"
"0","         stars = ifelse(p<.01, ""**"", stars),"
"0","         cor2 = paste0(cor, stars)) %>% "
"0","  mutate(across(c(var1, var2), "
"0","                function(x) str_replace_all(x, setNames(dimensions$var_label, dimensions$var_name)) %>% factor(levels = dimensions$var_label)))"
"0",""
"0","cor_plot <- upper_tri %>% "
"0","  ggplot(aes(var2, var1, fill = cor, label = cor2)) +"
"0","  geom_tile(color = ""white"") +"
"0","  scale_fill_gradient2(low = ""blue"", high = ""red"", "
"0","                       mid = ""white"", "
"0","                       midpoint = 0, limit = c(-1,1), "
"0","                       space = ""Lab"", "
"0","                       name = ""Pearson\nCorrelation"") +"
"0","  geom_text(col = ""black"") +"
"0","  theme_minimal() + # minimal theme"
"0","  theme("
"0","    axis.title.x = element_blank(),"
"0","    axis.title.y = element_blank(),"
"0","    panel.grid.major = element_blank(),"
"0","    panel.border = element_blank(),"
"0","    panel.background = element_blank(),"
"0","    axis.ticks = element_blank(),"
"0","    legend.justification = c(1, 0),"
"0","    legend.position = c(0.5, 0.6),"
"0","    legend.direction = ""horizontal"") +"
"0","  guides(fill = guide_colorbar(barwidth = 10, barheight = 2,"
"0","                               title.position = ""top"", title.hjust = 0.5)) +"
"0","  scale_y_discrete(labels = function(x) str_wrap(x, width = 10)) +"
"0","  scale_x_discrete(labels = function(x) str_wrap(x, width = 8)) +"
"0","  ggtitle(""Correlation heatmap of liberal attributes"")"
"0",""
"0","cor_plot %>% "
"0","  write_rds(""saved/cor_plot.rds"")"
"0",""
