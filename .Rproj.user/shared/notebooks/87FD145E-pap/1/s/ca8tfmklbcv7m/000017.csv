"0",""
"0","# assumptions"
"0",""
"0","n <- 100 # sample size per muni"
"0","n_muni <- 25"
"0","m <- 5 # participants per wg"
"0","n_wg <- 3 # number of wgs"
"0","b <- .2 # treatment effect in sds"
"0","n_wg_total <- n_wg*n_muni"
"0","icc <- 0.2"
"0","het_f <- 0.1 # heterogeneous effect for women"
"0","het_m <- 0.1 # heterogeneous effect for minorities"
"0",""
"0","f_prop <- 0.3 # proportion of women in sample"
"0","m_prop <- 0.2 # proportion of minorities in sample"
"0",""
"0","wgs <- rep(paste0(""wg"", 1:n_wg), each = m)"
"0",""
"0","# nasty assignment function that should be cleaned;"
"0","# currently it block assigns to treatment according to specified probs, then random assigns to WG"
"0",""
"0","block_assign <- function(data){"
"0","  "
"0","  data %>% "
"0","    group_by(municipality) |> "
"0","    mutate(prob = case_when("
"0","      female==0 & minority==0 ~ 1,"
"0","      female==0 & minority==1 ~ 2,"
"0","      female==1 & minority==0 ~ 1,"
"0","      female==1 & minority==1 ~ 2"
"0","    ),"
"0","    prob = n_wg*m*prob/sum(prob),"
"0","    treated = prob_ra(prob = prob,"
"0","                      blocks = paste(female, minority)), "
"0","    ipw = treated*(1/(prob)) + (1 - treated)*(1/(1 - prob))) |>"
"0","    ungroup() |>"
"0","    group_by(municipality, treated) %>% "
"0","    mutate(wg = sample(if(mean(treated)==1) wgs else rep(NA, n()), "
"0","                            size = n()),"
"0","           cluster = ifelse(treated==0, subjects, wg))"
"0","}"
"0",""
